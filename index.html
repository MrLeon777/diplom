<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>CryptoStego</title>
  </head>
  <body>
    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
<h4 style="color:blue">Выберете изображение (Не используйте изображение меньше чем 64х64)</h4>
<p><input type="file" id="file" accept="image/*" /></p>
<h4 style="color:blue">Введите пароль(необязательно)</h4>
<p>Пароль: <input type="text" id="pass" value="" placeholder="Нет пароля"/></p>
<h4 style="color:blue">Результат</h4>
<p>
<div id="result" style="background-color: rgba(0,255,0,0.3); padding: 10px 10px 10px 10px;">Выберите изображение и введите текст. Результат покажется тут</div>
</p>
<p>
<img id="resultimg" style="display:none" src="" />
</p>
<h4 style="color:blue">Напишите текст для шифрования</h4>
<p>
<textarea id="msg" style="width:100%;height:50px;">Этот текст зашифруется в изображение</textarea>
</p>
<a href="javascript: writeIMG()" class="button">Шифрование</a>
<p> </p>
<p>OR:</p>
<a href="javascript: readIMG()" class="button" style="background-image: url(images/main-bar1.png);"><span style="color:black">Расфифрование</span></a>
        </section>
      </div>
    </div>
<script type="text/javascript" src="javascripts/jquery.min.js"></script> <!--jQuery is not required by the library. We use it in DEMO page-->
<!-- CryptoStego JS files.-->
<script type="text/javascript" src="src/sha512.js"></script>
<script type="text/javascript" src="src/mersenne-twister.js"></script>
<script type="text/javascript" src="src/utf_8.js"></script>
<script type="text/javascript" src="src/utils.js"></script>
<script type="text/javascript" src="src/readimg.js"></script>
<script type="text/javascript" src="src/setimg.js"></script>
<script type="text/javascript" src="src/main.js"></script>
<!-- above scripts equivalent to <script type="text/javascript" src="cryptostego.min.js"></script>-->
<script type="text/javascript">
function writeIMG(){
    $("#resultimg").hide();
    $("#resultimg").attr('src','');
    $("#result").html('Выполняется...');
    function writefunc(){
        if(writeMsgToCanvas('canvas',$("#msg").val(),$("#pass").val(),0)!=null){
            var myCanvas = document.getElementById("canvas");
            var image = myCanvas.toDataURL("image/png");
            var element = document.createElement('a');
            element.setAttribute('href', image);
            element.setAttribute('download', 'result.png');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            $("#resultimg").attr('src',image);
            $("#result").html('Получилось!');
            $("#resultimg").show();
        } else $("#result").html(t);
    }
    loadIMGtoCanvas('file','canvas',writefunc,500);
}
function readIMG(){
    $("#resultimg").hide();
    $("#result").html('Processing...');
    function readfunc(){
        var t= readMsgFromCanvas('canvas',$("#pass").val(),0);
        if(t!=null){
            t=t.split('&').join('&amp;');
            t=t.split(' ').join('&nbsp;');
            t=t.split('<').join('&lt;');
            t=t.split('>').join('&gt;');
            t=t.replace(/(?:\r\n|\r|\n)/g, '<br />');
            $("#result").html(t);
        }else $("#result").html('ERROR REAVEALING MESSAGE!');

    }
    loadIMGtoCanvas('file','canvas',readfunc);
}
</script>

  </body>
</html>
